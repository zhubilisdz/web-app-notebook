# AI Native 记事本开发规划文档

## 项目概述

本项目是一个单用户、桌面优先的 Web 记事本应用，核心特色是深度集成 AI 功能，包括文本润色、自动生成标签和基于内容理解的语义搜索。

## 技术架构

### 前端技术栈
- **框架**: Vue.js 3
- **构建工具**: Vite
- **HTTP 客户端**: Axios
- **UI 组件**: 自定义组件
- **样式**: CSS3 + Flexbox/Grid

### 后端技术栈
- **框架**: Python + Flask
- **数据库**: SQLite + sqlite-vss (向量搜索扩展)
- **ORM**: SQLAlchemy
- **AI 服务**: Kimi API
- **环境管理**: python-dotenv

### 项目结构
```
trae-notebook/
├── frontend/          # Vue.js 前端应用
│   ├── src/
│   │   ├── components/
│   │   │   ├── NoteList.vue
│   │   │   ├── NoteEditor.vue
│   │   │   └── SidePanel.vue
│   │   ├── App.vue
│   │   └── main.js
│   ├── package.json
│   └── vite.config.js
├── backend/           # Flask 后端应用
│   ├── app.py
│   ├── models.py
│   ├── routes/
│   │   ├── notes.py
│   │   ├── ai.py
│   │   └── search.py
│   ├── services/
│   │   ├── kimi_service.py
│   │   └── vector_service.py
│   ├── requirements.txt
│   └── .env
└── README.md
```

## 详细开发步骤

### 第一阶段：环境搭建和项目初始化

#### 步骤 1.1：创建项目结构
- 创建主项目文件夹
- 创建 frontend 和 backend 子文件夹
- 初始化 Git 仓库

#### 步骤 1.2：后端环境搭建
- 安装 Python 依赖
- 创建虚拟环境
- 配置 Flask 基础应用
- 设置环境变量文件

#### 步骤 1.3：前端环境搭建
- 使用 Vite 创建 Vue 项目
- 安装必要的依赖包
- 配置开发服务器

### 第二阶段：后端核心功能开发

#### 步骤 2.1：数据库模型设计
- 定义 Note 模型（id, title, content, embedding, created_at, updated_at）
- 定义 Tag 模型（id, name）
- 定义 Note_Tag 关联表（note_id, tag_id）
- 配置 SQLAlchemy 和数据库连接

#### 步骤 2.2：基础 CRUD API 开发
- `GET /api/notes` - 获取所有笔记列表
- `GET /api/notes/:id` - 获取单个笔记详情
- `POST /api/notes` - 创建新笔记
- `PUT /api/notes/:id` - 更新笔记
- `DELETE /api/notes/:id` - 删除笔记

#### 步骤 2.3：Kimi API 集成准备
- 配置 Kimi API 密钥
- 创建 AI 服务封装类
- 实现基础的 API 调用功能

### 第三阶段：前端基础界面开发

#### 步骤 3.1：主应用布局
- 创建 App.vue 主容器
- 实现三栏式布局（左中右）
- 配置响应式设计

#### 步骤 3.2：笔记列表组件（NoteList.vue）
- 显示笔记标题和摘要
- 实现笔记选择功能
- 添加"创建新笔记"按钮
- 处理点击事件和状态管理

#### 步骤 3.3：笔记编辑器组件（NoteEditor.vue）
- 创建标题和内容编辑区域
- 实现文本选择功能
- 添加删除笔记按钮
- 预留 AI 功能按钮位置

#### 步骤 3.4：侧边面板组件（SidePanel.vue）
- 创建搜索输入框
- 设计标签显示区域
- 预留搜索结果显示区域

### 第四阶段：前后端数据交互

#### 步骤 4.1：HTTP 客户端配置
- 配置 Axios 实例
- 设置 API 基础 URL
- 实现错误处理机制

#### 步骤 4.2：笔记数据获取和显示
- 连接笔记列表 API
- 实现笔记详情加载
- 处理加载状态和错误状态

#### 步骤 4.3：笔记 CRUD 操作
- 实现创建新笔记功能
- 实现笔记更新（自动保存）
- 实现笔记删除功能
- 添加操作反馈提示

### 第五阶段：AI 功能集成

#### 步骤 5.1：文本润色功能
- 后端实现 `POST /api/ai/rewrite` 接口
- 前端添加文本选择和润色按钮
- 实现加载状态和结果替换
- 添加错误处理

#### 步骤 5.2：自动标签生成
- 后端集成标签生成 API 调用
- 修改笔记创建/更新接口，自动生成标签
- 前端显示生成的标签
- 实现标签的增删改功能

### 第六阶段：语义搜索功能

#### 步骤 6.1：向量数据库配置
- 安装和配置 sqlite-vss 扩展
- 修改数据库模型支持向量存储
- 实现向量生成和存储逻辑

#### 步骤 6.2：搜索功能实现
- 后端实现 `GET /api/search` 接口
- 实现查询向量化和相似度搜索
- 前端连接搜索框到搜索 API
- 显示搜索结果并支持点击跳转

### 第七阶段：用户体验优化

#### 步骤 7.1：交互优化
- 添加加载动画和进度指示器
- 实现自动保存功能（防抖处理）
- 添加操作确认对话框
- 优化键盘快捷键支持

#### 步骤 7.2：界面美化
- 设计现代化的 UI 界面
- 实现暗色/亮色主题切换
- 优化移动端适配
- 添加动画和过渡效果

#### 步骤 7.3：错误处理和用户反馈
- 完善错误提示机制
- 添加网络状态检测
- 实现离线提示
- 优化加载性能

### 第八阶段：测试和部署

#### 步骤 8.1：功能测试
- 单元测试编写
- 集成测试
- 用户体验测试
- 性能测试

#### 步骤 8.2：部署准备
- 生产环境配置
- 数据库迁移脚本
- 静态资源优化
- 安全性检查

## 开发时间估算

- **第一阶段**：1-2 天
- **第二阶段**：3-4 天
- **第三阶段**：3-4 天
- **第四阶段**：2-3 天
- **第五阶段**：4-5 天
- **第六阶段**：5-6 天
- **第七阶段**：3-4 天
- **第八阶段**：2-3 天

**总计**：约 23-31 天

## 关键技术难点

1. **向量搜索实现**：需要正确配置 sqlite-vss 并实现高效的相似度搜索
2. **AI API 集成**：处理 API 调用的异步性和错误处理
3. **实时自动保存**：实现防抖机制避免频繁 API 调用
4. **文本选择和替换**：在富文本编辑器中准确处理文本操作
5. **性能优化**：大量笔记时的列表渲染和搜索性能

## 风险评估和应对策略

### 技术风险
- **sqlite-vss 配置复杂**：准备备选方案，如使用 Faiss 或 Chroma
- **Kimi API 限制**：实现请求限流和错误重试机制
- **前端状态管理复杂**：考虑引入 Pinia 状态管理库

### 开发风险
- **时间估算偏差**：预留 20% 的缓冲时间
- **功能范围蔓延**：严格按照 MVP 原则，先实现核心功能

## 下一步行动

1. 确认开发环境和工具链
2. 获取 Kimi API 密钥
3. 开始第一阶段的环境搭建
4. 建立代码版本控制和备份机制

---

*本文档将随着开发进度动态更新，确保开发过程的可追踪性和可维护性。*